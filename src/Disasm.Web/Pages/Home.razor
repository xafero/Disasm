@page "/"

<PageTitle>Disasm Max | Online Disassembler</PageTitle>

<style>
    .my-panel {
        height: 90%;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
</style>

<div class="row g-3 p-3 min-vh-100">
    <div class="col-6 d-flex">
        <div class="editor-panel flex-fill d-flex">
            <textarea @bind="LeftTa" id="left" class="form-control flex-fill my-panel" readonly>
            </textarea>
        </div>
    </div>
    
    <div class="col-6 d-flex">
        <div class="output-panel flex-fill d-flex">
            <textarea @bind="RightTa" id="right" class="form-control flex-fill my-panel">
            </textarea>
        </div>
    </div>
</div>

@code {
    // ReSharper disable InconsistentNaming

    public string? LeftTa
    {
        get;
        set
        {
            if (field != value)
            {
                field = value;
                OnLeftChange(value);
            }
        }
    }

    public string? RightTa
    {
        get;
        set
        {
            if (field != value)
            {
                field = value;
                OnRightChange(value);
            }
        }
    }

    public void OnLeftChange(string? txt)
    {
        /* TODO */
    }

    public void OnRightChange(string? txt)
    {
        if (string.IsNullOrWhiteSpace(txt))
        {
            LeftTa = string.Empty;
            return;
        }
        const char nl = '\n';
        var lines = txt.Split(nl);
        var res = new List<string>();
        foreach (var line in lines)
        {
            var tmp = line.Replace(" ", "").Trim();
            try
            {
                var hex = Convert.FromHexString(tmp);
                // TODO
                res.Add(Convert.ToHexString(hex));
            }
            catch (Exception e)
            {
                res.Add(e.Message);
            }
        }
        LeftTa = string.Join(nl, res);
    }
}
